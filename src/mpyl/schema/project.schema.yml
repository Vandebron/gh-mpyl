---
$schema: https://json-schema.org/draft/2020-12/schema#
$id: schema/project.schema.yml
description: Description of a buildable artifact
required:
  - name
  - stages
  - description
  - maintainer
dependencies:
  deployment:
    - maintainer
additionalProperties: false
properties:
  name:
    description: Uniquely identifies this project
    type: string
    examples:
      - invoices
      - keycloak
  description:
    description: A one-liner to describe this project's role
    type: string
    examples:
      - Acts as a gateway and facade to the outside world
  mpylVersion:
    description: >-
      DEPRECATED: The MINIMAL version of MPyL that should be used to build this project. If not
      specified, the latest version will be used.
    type: string
  projectYmlVersion:
    description: >-
      The upgrade version of the project.yml, used for the Upgrader script.
    type: integer
  maintainer:
    description: >-
      Describes which team or guild is ultimately responsible for the life cycle
      of this particular project
    type: array
    items:
      type: string
    uniqueItems: true
    minItems: 1
  pipeline:
    description: The pipeline this project will be built with
    type: string
  stages:
    $id: '#/properties/stages'
    description: Defines which steps should be executed at each stage
    type: object
    additionalProperties: false
    propertyNames:
      $ref: mpyl_stages.schema.yml#/definitions/stageNames
    properties:
      build:
        description: Output needs to be a docker image
        examples:
          - Sbt Build
          - Docker Build
        type: string
      test:
        description: >-
          Output needs to be a junit test result file
          (https://svn.jenkins-ci.org/trunk/hudson/dtkit/dtkit-format/dtkit-junit-model/src/main/resources/com/thalesgroup/dtkit/junit/model/xsd/junit-4.xsd)
        examples:
          - Sbt Test
          - Docker Test
        type: string
      deploy:
        $id: '#/properties/stages/deploy'
        description: Deploys the artifacts created in the build stage
        examples:
          - Echo
        type: string
      postdeploy:
        description: Additional steps that can be done after the project has been deployed.
        examples:
          - Skip Postdeploy
        type: string
    minProperties: 1
  build:
    type: object
    additionalProperties: false
    properties:
      platforms:
        description: The build platforms for this project
        type: array
        items:
          type: string
    minProperties: 1
  postdeploy:
    additionalProperties: false
    type: object
    required:
      - specs
      - recordKey
    properties:
      specs:
        additionalProperties: false
        type: array
      recordKey:
        additionalProperties: false
        type: string
  dependencies:
    $ref: mpyl_stages.schema.yml#/definitions/dependencies
definitions:
  dtapValue:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - pr
          - test
          - acceptance
          - production
      - required:
          - all
    properties:
      pr:
        type: string
      test:
        type: string
      acceptance:
        type: string
      production:
        type: string
      all:
        type: string
  dtapNumberValue:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - pr
          - test
          - acceptance
          - production
      - required:
          - all
    properties:
      pr:
        type: number
      test:
        type: number
      acceptance:
        type: number
      production:
        type: number
      all:
        type: number
  label:
    type: object
    additionalProperties: false
    minProperties: 2
    required:
      - key
    properties:
      key:
        type: string
      pr:
        type: string
      test:
        type: string
      acceptance:
        type: string
      production:
        type: string
      all:
        type: string
